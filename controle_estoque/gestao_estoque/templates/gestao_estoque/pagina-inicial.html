{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
    />

    <link rel="stylesheet" href="{% static 'autenticacao/css/style.css' %}"
    type"text/css">

    <link
      rel="stylesheet"
      href="{% static 'autenticacao/css/pagina-inicial.css' %}"
      type="text/css"
    />

    <link
      rel="stylesheet"
      href="{% static 'autenticacao/css/media-query.css' %}"
      type="text/css"
    />

    <title>Santo Scenarium</title>
  </head>

  <body>
    <section class="main-login">
      <div class="card-login">
        <h1>Gerenciamento de utensílios</h1>

        <nav class="btn-geral">
          <ul class="btn-list">
            <li>Adicionar</li>
            <li>Registrar perda</li>
          </ul>
        </nav>

        <div class="textfield">
          <label for="produto">Produto:</label>
          <input
            type="text"
            id="campo_produto"
            placeholder="Digite o produto"
            oninput="buscarProduto()"
          />
          <div id="lista_sugestoes" class="lista-sugestoes">
            <!-- As sugestões serão inseridas aqui pelo JavaScript -->
          </div>
        </div>

        <div class="textfield">
          <label for="data">Data:</label>
          <input type="datetime-local" name="data" id="data" />
        </div>

        <div class="textfield">
          <label for="tipo">Tipo: </label>
          <input
            type="text"
            name="tipo"
            id="tipo"
            placeholder="Ex: copo, garfo"
            required
          />
        </div>

        <div class="textfield">
          <label for="quantidade">Quantidade: </label>
          <input
            type="number"
            name="quantidade"
            id="quantidade"
            placeholder="Quantidade a ser adicionada"
            required
          />
        </div>

        <div class="textfield">
          <label for="mensagem">Sua mensagem</label>
          <textarea name="mensagem" id="mensagem" cols="30" rows="5"></textarea>
        </div>

        <button class="btn-login">Exportar</button>
      </div>
    </section>

    <script>
      function buscarProduto() {
        var termo = document.getElementById('campo_produto').value;
        var listaSugestoes = document.getElementById('lista_sugestoes');

        while (listaSugestoes.firstChild) {
          listaSugestoes.removeChild(listaSugestoes.firstChild);
        }

        if (termo.length >= 2) {
          fetch(
            `/pagina_inicial/buscar-produtos/?termo=${encodeURIComponent(
              termo,
            )}`,
          )
            .then((response) => response.json())
            .then((data) => {
              if (data.length) {
                listaSugestoes.classList.add('visible');
              } else {
                listaSugestoes.classList.remove('visible');
              }
              data.forEach((nomeProduto) => {
                var div = document.createElement('div');
                div.textContent = nomeProduto;
                div.onclick = function () {
                  document.getElementById('campo_produto').value = nomeProduto;
                  listaSugestoes.classList.remove('visible');
                };
                listaSugestoes.appendChild(div);
              });
            })
            .catch((error) => console.error('Erro:', error));
        } else {
          listaSugestoes.classList.remove('visible');
        }
      }

      document.addEventListener('click', function (e) {
        var listaSugestoes = document.getElementById('lista_sugestoes');
        if (
          e.target.id !== 'campo_produto' &&
          !listaSugestoes.contains(e.target)
        ) {
          listaSugestoes.classList.remove('visible');
        }
      });
    </script>
  </body>
</html>
